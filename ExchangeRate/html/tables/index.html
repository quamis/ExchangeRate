<!doctype html>
<html ng-app="ExchangeRate" >
<head>
	<meta charset="utf-8">
	<title>xCh - data tables</title>
	<script>document.write('<base href="' + document.location + '" />');</script>
	<script src="lib/moment.js/moment.js"></script>
	
	<script src="../ExchangeRate-data.js"></script>
	
	<script src="lib/jquery/jquery.min.js"></script>
	<script src="lib/underscore.js/underscore.js"></script>
	
	<script src="js/index.js"></script>
	<script src="js/xCH.js"></script>
	<script src="js/ExchangeRateDataParser.js"></script>
	<!-- CSS -->
	<link rel="stylesheet" href="css/index.css">
	
	<script src="lib/d3.js/d3.v3.js"></script>
	<script src="lib/nv.d3.js/nv.d3.js"></script>
	<!-- CSS -->
	<link rel="stylesheet" href="lib/nv.d3.css">
	<style>
body {
  overflow-y:scroll;
}

text {
  font: 12px sans-serif;
}

svg {
  display: block;
}

#chart1 svg {
  height: 500px;
  min-width: 100px;
  min-height: 100px;
/*
  margin: 50px;
  Minimum height and width is a good idea to prevent negative SVG dimensions...
  For example width should be =< margin.left + margin.right + 1,
  of course 1 pixel for the entire chart would not be very useful, BUT should not have errors
*/
}

</style>
  
</head>
<body>
	<div id="xCHFilters">
		<table>
			<tr>
				<td>Days</td>
				<td id="displayedDays" >
					<div class="selector">
						<span></span>
						<input type="range" value="14" min="3" max="360" step="1">
					</div>
					<div class='shortcuts'>
						<span data-value="3">3d</span>
						<span data-value="7">1w</span>
						<span data-value="14">2w</span>
						<span data-value="21">3w</span>
						<span data-value="31">1m</span>
						<span data-value="92">3m</span>
					</div>
				</td>
			</tr>
		</table>
	</div>
	
	<div id="xCHTarget" style="display:none;">
	</div>
	
	<div id="xCHGraph">	
		<div id="chart" class='with-3d-shadow with-transitions'>
			<svg style="height: 500px;"></svg>
		</div>
	</div>

	<script> 
		xchData = new ExchangeRateDataParser(ExchangeRateData);
		xchData.addFilter('startDate', moment().subtract('days', $('#displayedDays>div.selector>input').val()).toDate());
		xch = new _xCH( xchData ); 
		xch.attach($('#xCHTarget')).reset().render();
		
		function updateDataSeries() {
			updateDataSeries.timeout = null;
			xch.data.setFilter('startDate', moment().subtract('days', $('#displayedDays>div.selector>input').val()).toDate())
			xch.reset();
			setTimeout(function(){
				xch.render();
			}, 1);
		}
		
		$('#displayedDays>div.shortcuts>span').click(function(evt){
			$('#displayedDays>div.selector>input').val($(evt.target).attr('data-value'));
			$('#displayedDays>div.selector>span').html($('#displayedDays>div.selector>input').val());
			updateDataSeries();
		});
		
		$('#displayedDays>div.selector>input').mousemove(function(){
			$('#displayedDays>div.selector>span').html($('#displayedDays>div.selector>input').val());
			
			if(updateDataSeries.timeout) {
				clearTimeout(updateDataSeries.timeout);
			}
			updateDataSeries.timeout = setTimeout(updateDataSeries, 2500);
		});
		
		$('#displayedDays>input').change(function(){
			if(updateDataSeries.timeout) {
				clearTimeout(updateDataSeries.timeout);
			}
			updateDataSeries.timeout = null;
			updateDataSeries();
		});
		
		
		
		
		
		
		
		$().ready(function(){
			nv.addGraph(function() {
			  var chart = nv.models.lineWithFocusChart();

			 // chart.transitionDuration(500);
			  chart.xAxis
				  .tickFormat(d3.format(',f'));
			  chart.x2Axis
				  .tickFormat(d3.format(',f'));

			  chart.yAxis
				  .tickFormat(d3.format(',.2f'));
			  chart.y2Axis
				  .tickFormat(d3.format(',.2f'));

			  d3.select('#chart svg')
				  .datum(getGraphData())
				  .call(chart);

			  nv.utils.windowResize(chart.update);

			  return chart;
			});
		});
		
		function getGraphData() {
		  var gd = [];
		  
		  var d = [];
		  d['key'] = "EUR - sell";
		  d['values'] = [];
		  d['values'].push({ x:12, y:4.4 });
		  d['values'].push({ x:13, y:4.5 });
		  d['values'].push({ x:14, y:4.6 });
		  d['values'].push({ x:15, y:4.7 });
		  
		  gd.push(d);
		  return gd;
		}
	</script>
</body>
</html>